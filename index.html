<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CollabSpace - Final Version</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
  <style>
    :root {
      --primary: #6C5CE7;
      --secondary: #00B894;
      --dark: #2D3436;
      --light: #F5F6FA;
      --warning: #FDCB6E;
      --danger: #E17055;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', system-ui, sans-serif;
    }
    
    body {
      background: var(--light);
      color: var(--dark);
    }
    
    .app-container {
      display: grid;
      grid-template-columns: 280px 1fr;
      height: 100vh;
    }
    
    /* Workspace Sidebar */
    .workspace-sidebar {
      background: var(--dark);
      color: white;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }
    
    .workspace-header {
      display: flex;
      align-items: center;
      margin-bottom: 30px;
    }
    
    .workspace-logo {
      width: 40px;
      height: 40px;
      background: var(--primary);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      font-weight: bold;
    }
    
    .workspace-name {
      font-size: 18px;
      font-weight: 600;
    }
    
    .workspace-menu {
      margin-top: 30px;
      flex-grow: 1;
    }
    
    .menu-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      border-radius: 6px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .menu-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .menu-item.active {
      background: var(--primary);
    }
    
    .menu-icon {
      margin-right: 12px;
      font-size: 18px;
    }
    
    .workspace-footer {
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .user-profile {
      display: flex;
      align-items: center;
    }
    
    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--secondary);
      margin-right: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    
    /* Main Content */
    .main-content {
      display: grid;
      grid-template-rows: 60px 1fr 80px;
    }
    
    .channel-header {
      display: flex;
      align-items: center;
      padding: 0 20px;
      border-bottom: 1px solid #e0e0e0;
    }
    
    .channel-title {
      font-size: 20px;
      font-weight: 600;
    }
    
    .channel-actions {
      margin-left: auto;
      display: flex;
      gap: 20px;
    }
    
    .action-button {
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: var(--dark);
    }
    
    /* Messages Area */
    .messages-container {
      padding: 20px;
      overflow-y: auto;
      background: white;
    }
    
    .message {
      display: flex;
      margin-bottom: 20px;
      max-width: 80%;
    }
    
    .message-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--warning);
      margin-right: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
    }
    
    .message-content {
      flex-grow: 1;
    }
    
    .message-header {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
    }
    
    .message-sender {
      font-weight: 600;
      margin-right: 10px;
    }
    
    .message-time {
      font-size: 12px;
      color: #7f8c8d;
    }
    
    .message-text {
      line-height: 1.5;
    }
    
    .message-actions {
      display: flex;
      margin-top: 8px;
    }
    
    .message-action {
      background: none;
      border: none;
      color: #7f8c8d;
      font-size: 12px;
      margin-right: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
    }
    
    .message-action:hover {
      color: var(--primary);
    }
    
    /* Input Area */
    .input-area {
      padding: 15px 20px;
      border-top: 1px solid #e0e0e0;
      background: white;
      position: relative;
    }
    
    .message-input {
      width: 100%;
      height: 50px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 12px 15px;
      font-size: 14px;
      outline: none;
      resize: none;
    }
    
    .input-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    
    .action-icons {
      display: flex;
      gap: 15px;
    }
    
    .input-icon {
      font-size: 18px;
      color: #7f8c8d;
      cursor: pointer;
    }
    
    .send-button {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 15px;
      font-weight: 500;
      cursor: pointer;
    }
    
    /* Task Feature */
    .task-message {
      background: #f1f3fe;
      border-left: 3px solid var(--primary);
      padding: 12px;
      border-radius: 0 6px 6px 0;
      margin-top: 8px;
    }
    
    .task-header {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .task-title {
      font-weight: 600;
      margin-right: 10px;
    }
    
    .task-status {
      font-size: 12px;
      padding: 2px 8px;
      border-radius: 12px;
      background: var(--secondary);
      color: white;
    }
    
    .task-status.pending {
      background: var(--warning);
      color: var(--dark);
    }
    
    .task-deadline {
      font-size: 12px;
      color: #7f8c8d;
      margin-top: 6px;
    }
    
    /* File Attachment */
    .file-attachment {
      display: flex;
      align-items: center;
      background: #f1f3fe;
      padding: 8px 12px;
      border-radius: 6px;
      margin-top: 8px;
      width: fit-content;
      cursor: pointer;
    }
    
    .file-icon {
      margin-right: 10px;
      color: var(--primary);
    }
    
    .file-name {
      font-size: 14px;
      margin-right: 10px;
    }
    
    .file-size {
      font-size: 12px;
      color: #7f8c8d;
    }
    
    /* Decision Feature */
    .decision-message {
      background: #e3f9f4;
      border-left: 3px solid var(--secondary);
      padding: 12px;
      border-radius: 0 6px 6px 0;
      margin-top: 8px;
    }
    
    .decision-title {
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .decision-options {
      margin-top: 10px;
    }
    
    .decision-option {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .option-label {
      flex-grow: 1;
    }
    
    .option-votes {
      font-size: 12px;
      color: #7f8c8d;
    }
    
    .decision-button {
      background: var(--secondary);
      color: white;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 12px;
      margin-top: 10px;
      cursor: pointer;
    }
    
    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    
    .modal {
      background: white;
      border-radius: 8px;
      padding: 20px;
      width: 400px;
      max-width: 90%;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-title {
      font-size: 18px;
      font-weight: 600;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }
    
    .form-input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    
    .form-textarea {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      resize: vertical;
      min-height: 80px;
    }
    
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
    
    .form-button {
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
    }
    
    .form-button.primary {
      background: var(--primary);
      color: white;
      border: none;
    }
    
    .form-button.secondary {
      background: none;
      border: 1px solid #ddd;
    }
    
    /* Progress Bar */
    .progress-bar {
      height: 6px;
      background: #eee;
      border-radius: 3px;
      margin-top: 10px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: var(--secondary);
      width: 0%;
      transition: width 0.3s;
    }
    
    /* Typing Indicator */
    .typing-indicator {
      display: flex;
      align-items: center;
      margin-left: 48px;
      margin-bottom: 10px;
    }
    
    .typing-dot {
      width: 8px;
      height: 8px;
      background: #7f8c8d;
      border-radius: 50%;
      margin-right: 4px;
      animation: typing 1.4s infinite ease-in-out;
    }
    
    .typing-dot:nth-child(1) {
      animation-delay: 0s;
    }
    
    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes typing {
      0%, 60%, 100% {
        transform: translateY(0);
      }
      30% {
        transform: translateY(-5px);
      }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDUxwEXAMPLE-KEY-123",
      authDomain: "your-project.firebaseapp.com",
      projectId: "your-project-id",
      storageBucket: "your-bucket.appspot.com",
      messagingSenderId: "1234567890",
      appId: "1:1234567890:web:abc123def456"
    };

    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(app);
    const storage = firebase.storage(app);

    // Socket.io Client
    const socket = io('https://your-socketio-server.com');

    function App() {
      // User state
      const [currentUser, setCurrentUser] = useState({
        id: 'user_' + Math.floor(Math.random() * 1000),
        name: 'You',
        avatar: 'YO',
        online: true
      });
      
      // App state
      const [activeChannel, setActiveChannel] = useState('general');
      const [channels, setChannels] = useState([
        { id: 'general', name: 'General', icon: 'hashtag' },
        { id: 'design', name: 'Design Team', icon: 'palette' },
        { id: 'dev', name: 'Development', icon: 'code' },
        { id: 'marketing', name: 'Marketing', icon: 'bullhorn' },
        { id: 'projects', name: 'Projects', icon: 'tasks' }
      ]);
      
      const [messages, setMessages] = useState([]);
      const [message, setMessage] = useState('');
      const [isTyping, setIsTyping] = useState(false);
      const [otherTyping, setOtherTyping] = useState(false);
      const [showTaskModal, setShowTaskModal] = useState(false);
      const [showPollModal, setShowPollModal] = useState(false);
      const [uploadProgress, setUploadProgress] = useState(0);
      const [file, setFile] = useState(null);
      const fileInputRef = useRef(null);
      const messagesEndRef = useRef(null);
      
      // Form states
      const [taskForm, setTaskForm] = useState({
        title: '',
        description: '',
        deadline: ''
      });
      
      const [pollForm, setPollForm] = useState({
        question: '',
        options: ['', '']
      });
      
      // Load initial messages
      useEffect(() => {
        const demoMessages = [
          {
            id: '1',
            sender: { id: 'user1', name: 'Alex Johnson', avatar: 'AJ' },
            time: '10:30 AM',
            text: "Let's discuss the Q3 roadmap",
            type: 'text',
            channel: 'general'
          },
          {
            id: '2',
            sender: { id: 'user2', name: 'Sam Lee', avatar: 'SL' },
            time: '10:32 AM',
            text: "I've created a task for the homepage redesign",
            type: 'task',
            task: {
              id: 'task1',
              title: 'Homepage Redesign',
              description: 'Update the homepage with new branding',
              status: 'in-progress',
              deadline: '2023-12-15',
              assignee: 'user1'
            },
            channel: 'general'
          },
          {
            id: '3',
            sender: { id: 'user3', name: 'Taylor Chen', avatar: 'TC' },
            time: '10:35 AM',
            text: "Should we use React or Vue for the new project?",
            type: 'poll',
            poll: {
              id: 'poll1',
              question: 'Framework for new project',
              options: [
                { id: 'opt1', text: 'React', votes: 3, voters: ['user1', 'user2', 'user4'] },
                { id: 'opt2', text: 'Vue', votes: 1, voters: ['user3'] }
              ],
              voted: false
            },
            channel: 'general'
          }
        ];
        
        setMessages(demoMessages);
        
        // In a real app, you would subscribe to Firestore/Socket.io here
        socket.on('newMessage', (newMessage) => {
          setMessages(prev => [...prev, newMessage]);
        });
        
        socket.on('typing', (typing) => {
          setOtherTyping(typing);
        });
        
        return () => {
          socket.off('newMessage');
          socket.off('typing');
        };
      }, []);
      
      // Auto-scroll to bottom when messages change
      useEffect(() => {
        scrollToBottom();
      }, [messages]);
      
      // Typing indicator logic
      useEffect(() => {
        if (message.trim()) {
          if (!isTyping) {
            socket.emit('typing', true);
            setIsTyping(true);
          }
          
          const timer = setTimeout(() => {
            socket.emit('typing', false);
            setIsTyping(false);
          }, 2000);
          
          return () => clearTimeout(timer);
        } else {
          if (isTyping) {
            socket.emit('typing', false);
            setIsTyping(false);
          }
        }
      }, [message]);
      
      // Helper functions
      const scrollToBottom = () => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      };
      
      const formatTime = (date) => {
        return date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      };
      
      // Message handlers
      const handleSendMessage = (e) => {
        e.preventDefault();
        if (!message.trim()) return;
        
        const newMessage = {
          id: Date.now().toString(),
          sender: currentUser,
          time: formatTime(new Date()),
          text: message,
          type: 'text',
          channel: activeChannel
        };
        
        // In a real app, you would save to Firestore and emit via Socket.io
        setMessages(prev => [...prev, newMessage]);
        socket.emit('sendMessage', newMessage);
        setMessage('');
      };
      
      const handleCreateTask = (e) => {
        e.preventDefault();
        
        const newTask = {
          id: 'task_' + Date.now(),
          title: taskForm.title,
          description: taskForm.description,
          status: 'in-progress',
          deadline: taskForm.deadline,
          assignee: null
        };
        
        const newMessage = {
          id: 'msg_' + Date.now(),
          sender: currentUser,
          time: formatTime(new Date()),
          text: `Created task: ${taskForm.title}`,
          type: 'task',
          task: newTask,
          channel: activeChannel
        };
        
        setMessages(prev => [...prev, newMessage]);
        socket.emit('sendMessage', newMessage);
        setShowTaskModal(false);
        setTaskForm({ title: '', description: '', deadline: '' });
      };
      
      const handleCreatePoll = (e) => {
        e.preventDefault();
        
        const newPoll = {
          id: 'poll_' + Date.now(),
          question: pollForm.question,
          options: pollForm.options
            .filter(opt => opt.trim())
            .map((opt, idx) => ({
              id: 'opt_' + idx,
              text: opt,
              votes: 0,
              voters: []
            })),
          voted: false
        };
        
        const newMessage = {
          id: 'msg_' + Date.now(),
          sender: currentUser,
          time: formatTime(new Date()),
          text: `New poll: ${pollForm.question}`,
          type: 'poll',
          poll: newPoll,
          channel: activeChannel
        };
        
        setMessages(prev => [...prev, newMessage]);
        socket.emit('sendMessage', newMessage);
        setShowPollModal(false);
        setPollForm({ question: '', options: ['', ''] });
      };
      
      const handleVote = (pollId, optionId) => {
        const updatedMessages = messages.map(msg => {
          if (msg.type === 'poll' && msg.poll.id === pollId) {
            const updatedOptions = msg.poll.options.map(opt => {
              if (opt.id === optionId) {
                return {
                  ...opt,
                  votes: opt.votes + 1,
                  voters: [...opt.voters, currentUser.id]
                };
              }
              return opt;
            });
            
            return {
              ...msg,
              poll: {
                ...msg.poll,
                options: updatedOptions,
                voted: true
              }
            };
          }
          return msg;
        });
        
        setMessages(updatedMessages);
        socket.emit('updateMessage', updatedMessages.find(msg => 
          msg.type === 'poll' && msg.poll.id === pollId
        ));
      };
      
      const handleTaskUpdate = (taskId, status) => {
        const updatedMessages = messages.map(msg => {
          if (msg.type === 'task' && msg.task.id === taskId) {
            return {
              ...msg,
              task: {
                ...msg.task,
                status: status
              }
            };
          }
          return msg;
        });
        
        setMessages(updatedMessages);
        socket.emit('updateMessage', updatedMessages.find(msg => 
          msg.type === 'task' && msg.task.id === taskId
        ));
      };
      
      const handleFileChange = (e) => {
        const selectedFile = e.target.files[0];
        if (!selectedFile) return;
        
        setFile(selectedFile);
        
        // Simulate upload progress
        let progress = 0;
        const interval = setInterval(() => {
          progress += 10;
          setUploadProgress(progress);
          
          if (progress >= 100) {
            clearInterval(interval);
            
            // After upload completes
            setTimeout(() => {
              const newMessage = {
                id: 'msg_' + Date.now(),
                sender: currentUser,
                time: formatTime(new Date()),
                text: `Shared file: ${selectedFile.name}`,
                type: 'file',
                file: {
                  name: selectedFile.name,
                  size: (selectedFile.size / 1024 / 1024).toFixed(1) + ' MB',
                  url: URL.createObjectURL(selectedFile)
                },
                channel: activeChannel
              };
              
              setMessages(prev => [...prev, newMessage]);
              socket.emit('sendMessage', newMessage);
              setFile(null);
              setUploadProgress(0);
            }, 500);
          }
        }, 200);
      };
      
      const filteredMessages = messages.filter(msg => msg.channel === activeChannel);

      return (
        <div className="app-container">
          {/* Workspace Sidebar */}
          <div className="workspace-sidebar">
            <div className="workspace-header">
              <div className="workspace-logo">CS</div>
              <div className="workspace-name">CollabSpace</div>
            </div>
            
            <div className="workspace-menu">
              {channels.map(channel => (
                <div 
                  key={channel.id}
                  className={`menu-item ${activeChannel === channel.id ? 'active' : ''}`}
                  onClick={() => setActiveChannel(channel.id)}
                >
                  <i className={`fas fa-${channel.icon} menu-icon`}></i>
                  {channel.name}
                </div>
              ))}
            </div>
            
            <div className="workspace-footer">
              <div className="user-profile">
                <div className="user-avatar">{currentUser.avatar}</div>
                <div>
                  <div style={{ fontWeight: 600 }}>{currentUser.name}</div>
                  <div style={{ fontSize: 12, opacity: 0.8 }}>
                    {currentUser.online ? 'Online' : 'Offline'}
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          {/* Main Content */}
          <div className="main-content">
            <div className="channel-header">
              <div className="channel-title">
                {channels.find(c => c.id === activeChannel)?.name || 'General'}
              </div>
              
              <div className="channel-actions">
                <button className="action-button">
                  <i className="fas fa-search"></i>
                </button>
                <button className="action-button">
                  <i className="fas fa-ellipsis"></i>
                </button>
              </div>
            </div>
            
            <div className="messages-container">
              {filteredMessages.map(msg => (
                <div key={msg.id} className="message">
                  <div className="message-avatar">
                    {msg.sender.avatar}
                  </div>
                  
                  <div className="message-content">
                    <div className="message-header">
                      <div className="message-sender">
                        {msg.sender.name}
                      </div>
                      <div className="message-time">
                        {msg.time}
                      </div>
                    </div>
                    
                    <div className="message-text">
                      {msg.text}
                    </div>
                    
                    {/* Task Message */}
                    {msg.type === 'task' && (
                      <div className="task-message">
                        <div className="task-header">
                          <div className="task-title">
                            {msg.task.title}
                          </div>
                          <div className={`task-status ${msg.task.status === 'in-progress' ? 'pending' : ''}`}>
                            {msg.task.status === 'in-progress' ? 'In Progress' : 'Completed'}
                          </div>
                        </div>
                        
                        {msg.task.description && (
                          <div style={{ margin: '8px 0', fontSize: '14px' }}>
                            {msg.task.description}
                          </div>
                        )}
                        
                        {msg.task.deadline && (
                          <div className="task-deadline">
                            Deadline: {msg.task.deadline}
                          </div>
                        )}
                        
                        {(msg.sender.id === currentUser.id || msg.task.assignee === currentUser.id) && (
                          <div style={{ marginTop: 10 }}>
                            <button 
                              className="decision-button"
                              onClick={() => handleTaskUpdate(msg.task.id, 'completed')}
                              style={{ marginRight: 8 }}
                            >
                              Mark Complete
                            </button>
                            <button 
                              className="decision-button"
                              onClick={() => handleTaskUpdate(msg.task.id, 'in-progress')}
                              style={{ background: '#E17055' }}
                            >
                              Reopen Task
                            </button>
                          </div>
                        )}
                      </div>
                    )}
                    
                    {/* Poll Message */}
                    {msg.type === 'poll' && (
                      <div className="decision-message">
                        <div className="decision-title">
                          {msg.poll.question}
                        </div>
                        
                        <div className="decision-options">
                          {msg.poll.options.map(option => (
                            <div key={option.id} className="decision-option">
                              {!msg.poll.voted ? (
                                <>
                                  <input 
                                    type="radio" 
                                    id={`${msg.poll.id}_${option.id}`}
                                    name={msg.poll.id}
                                    onChange={() => handleVote(msg.poll.id, option.id)}
                                  />
                                  <label htmlFor={`${msg.poll.id}_${option.id}`} className="option-label">
                                    {option.text}
                                  </label>
                                </>
                              ) : (
                                <>
                                  <div className="option-label">
                                    {option.text}
                                  </div>
                                  <div className="option-votes">
                                    ({option.votes} votes)
                                  </div>
                                </>
                              )}
                            </div>
                          ))}
                        </div>
                        
                        {msg.poll.voted && (
                          <div style={{ marginTop: 8, fontSize: 12, color: '#00B894' }}>
                            <i className="fas fa-check"></i> You voted in this poll
                          </div>
                        )}
                      </div>
                    )}
                    
                    {/* File Message */}
                    {msg.type === 'file' && (
                      <div 
                        className="file-attachment"
                        onClick={() => window.open(msg.file.url, '_blank')}
                      >
                        <i className="fas fa-file-alt file-icon"></i>
                        <div className="file-name">
                          {msg.file.name}
                        </div>
                        <div className="file-size">
                          {msg.file.size}
                        </div>
                      </div>
                    )}
                    
                    <div className="message-actions">
                      <button className="message-action">
                        <i className="far fa-thumbs-up"></i> Like
                      </button>
                      <button className="message-action">
                        <i className="fas fa-reply"></i> Reply
                      </button>
                    </div>
                  </div>
                </div>
              ))}
              
              {otherTyping && (
                <div className="typing-indicator">
                  <div className="typing-dot"></div>
                  <div className="typing-dot"></div>
                  <div className="typing-dot"></div>
                  <span style={{ marginLeft: '8px', fontSize: '12px', color: '#7f8c8d' }}>
                    Someone is typing...
                  </span>
                </div>
              )}
              
              <div ref={messagesEndRef} />
            </div>
            
            <div className="input-area">
              {file && (
                <div style={{ 
                  marginBottom: '10px',
                  padding: '10px',
                  background: '#f1f3fe',
                  borderRadius: '8px',
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center'
                }}>
                  <div>
                    <i className="fas fa-file-alt" style={{ marginRight: '8px' }}></i>
                    {file.name}
                  </div>
                  <button 
                    onClick={() => setFile(null)}
                    style={{ 
                      background: 'none',
                      border: 'none',
                      color: '#E17055',
                      cursor: 'pointer'
                    }}
                  >
                    <i className="fas fa-times"></i>
                  </button>
                </div>
              )}
              
              {uploadProgress > 0 && (
                <div style={{ marginBottom: '10px' }}>
                  <div style={{ 
                    display: 'flex',
                    justifyContent: 'space-between',
                    fontSize: '12px',
                    marginBottom: '4px'
                  }}>
                    <span>Uploading...</span>
                    <span>{uploadProgress}%</span>
                  </div>
                  <div className="progress-bar">
                    <div 
                      className="progress-fill" 
                      style={{ width: `${uploadProgress}%` }}
                    ></div>
                  </div>
                </div>
              )}
              
              <form onSubmit={handleSendMessage}>
                <textarea
                  className="message-input"
                  value={message}
                  onChange={(e) => setMessage(e.target.value)}
                  placeholder={`Message ${channels.find(c => c.id === activeChannel)?.name || 'General'}...`}
                />
                
                <div className="input-actions">
                  <div className="action-icons">
                    <input 
                      type="file" 
                      ref={fileInputRef}
                      onChange={handleFileChange}
                      style={{ display: 'none' }}
                    />
                    <i 
                      className="fas fa-paperclip input-icon"
                      onClick={() => fileInputRef.current.click()}
                    ></i>
                    <i 
                      className="fas fa-tasks input-icon"
                      onClick={() => setShowTaskModal(true)}
                    ></i>
                    <i 
                      className="fas fa-poll input-icon"
                      onClick={() => setShowPollModal(true)}
                    ></i>
                  </div>
                  
                  <button 
                    type="submit" 
                    className="send-button"
                    disabled={!message.trim() && !file}
                  >
                    Send <i className="fas fa-paper-plane"></i>
                  </button>
                </div>
              </form>
            </div>
          </div>
          
          {/* Task Modal */}
          {showTaskModal && (
            <div className="modal-overlay">
              <div className="modal">
                <div className="modal-header">
                  <div className="modal-title">Create New Task</div>
                  <button 
                    className="modal-close"
                    onClick={() => setShowTaskModal(false)}
                  >
                    &times;
                  </button>
                </div>
                
                <form onSubmit={handleCreateTask}>
                  <div className="form-group">
                    <label className="form-label">Task Title</label>
                    <input
                      type="text"
                      className="form-input"
                      value={taskForm.title}
                      onChange={(e) => setTaskForm({...taskForm, title: e.target.value})}
                      required
                    />
                  </div>
                  
                  <div className="form-group">
                    <label className="form-label">Description</label>
                    <textarea
                      className="form-textarea"
                      value={taskForm.description}
                      onChange={(e) => setTaskForm({...taskForm, description: e.target.value})}
                    />
                  </div>
                  
                  <div className="form-group">
                    <label className="form-label">Deadline</label>
                    <input
                      type="date"
                      className="form-input"
                      value={taskForm.deadline}
                      onChange={(e) => setTaskForm({...taskForm, deadline: e.target.value})}
                    />
                  </div>
                  
                  <div className="form-actions">
                    <button 
                      type="button"
                      className="form-button secondary"
                      onClick={() => setShowTaskModal(false)}
                    >
                      Cancel
                    </button>
                    <button 
                      type="submit"
                      className="form-button primary"
                    >
                      Create Task
                    </button>
                  </div>
                </form>
              </div>
            </div>
          )}
          
          {/* Poll Modal */}
          {showPollModal && (
            <div className="modal-overlay">
              <div className="modal">
                <div className="modal-header">
                  <div className="modal-title">Create New Poll</div>
                  <button 
                    className="modal-close"
                    onClick={() => setShowPollModal(false)}
                  >
                    &times;
                  </button>
                </div>
                
                <form onSubmit={handleCreatePoll}>
                  <div className="form-group">
                    <label className="form-label">Question</label>
                    <input
                      type="text"
                      className="form-input"
                      value={pollForm.question}
                      onChange={(e) => setPollForm({...pollForm, question: e.target.value})}
                      required
                    />
                  </div>
                  
                  <div className="form-group">
                    <label className="form-label">Options</label>
                    {pollForm.options.map((option, index) => (
                      <input
                        key={index}
                        type="text"
                        className="form-input"
                        style={{ marginBottom: '8px' }}
                        value={option}
                        onChange={(e) => {
                          const newOptions = [...pollForm.options];
                          newOptions[index] = e.target.value;
                          setPollForm({...pollForm, options: newOptions});
                        }}
                        required={index < 2}
                      />
                    ))}
                    
                    <button
                      type="button"
                      style={{
                        background: 'none',
                        border: 'none',
                        color: 'var(--primary)',
                        cursor: 'pointer',
                        fontSize: '14px',
                        marginTop: '8px'
                      }}
                      onClick={() => setPollForm({
                        ...pollForm,
                        options: [...pollForm.options, '']
                      })}
                    >
                      <i className="fas fa-plus"></i> Add Option
                    </button>
                  </div>
                  
                  <div className="form-actions">
                    <button 
                      type="button"
                      className="form-button secondary"
                      onClick={() => setShowPollModal(false)}
                    >
                      Cancel
                    </button>
                    <button 
                      type="submit"
                      className="form-button primary"
                    >
                      Create Poll
                    </button>
                  </div>
                </form>
              </div>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
