<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NexaChat Premium</title>
  <!-- Load React dan Babel dari CDN yang reliable -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Load Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  
  <!-- Load Font Awesome untuk ikon -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* Reset CSS */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background-color: #f5f7fa;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    /* Container Aplikasi */
    .app-container {
      width: 100%;
      max-width: 1200px;
      height: 90vh;
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      overflow: hidden;
      display: grid;
      grid-template-columns: 300px 1fr;
    }
    
    /* Sidebar Styles */
    .sidebar {
      background: #2D3436;
      color: white;
      display: flex;
      flex-direction: column;
    }
    
    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .sidebar-title {
      font-size: 18px;
      font-weight: 600;
      color: white;
    }
    
    /* Chat List Styles */
    .chat-list {
      flex: 1;
      overflow-y: auto;
      padding: 10px 0;
    }
    
    .chat-item {
      padding: 12px 20px;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .chat-item:hover {
      background: rgba(255,255,255,0.1);
    }
    
    /* Chat Area Styles */
    .chat-area {
      display: flex;
      flex-direction: column;
    }
    
    .chat-header {
      padding: 15px 20px;
      border-bottom: 1px solid #eee;
    }
    
    /* Auth Styles */
    .auth-container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
      width: 400px;
      padding: 40px;
    }
    
    .auth-title {
      text-align: center;
      margin-bottom: 30px;
      color: #2D3436;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-input {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 15px;
    }
    
    .auth-button {
      background: #6C5CE7;
      color: white;
      border: none;
      padding: 12px;
      border-radius: 8px;
      width: 100%;
      cursor: pointer;
    }
    
    /* Tambahan styling untuk versi premium */
    .message-bubble {
      background: white;
      padding: 12px 16px;
      border-radius: 18px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      max-width: 70%;
    }
    
    .typing-indicator {
      display: flex;
      align-items: center;
      color: #636E72;
      font-size: 13px;
    }
    
    /* Animasi */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .message {
      animation: fadeIn 0.3s ease;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    
    // Konfigurasi Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCH05exvW9is7JYTqT0PFAzWDJoBji6uWQ",
      authDomain: "interaktifberfikir-70ac0.firebaseapp.com",
      projectId: "interaktifberfikir-70ac0",
      storageBucket: "interaktifberfikir-70ac0.appspot.com",
      messagingSenderId: "931930581619",
      appId: "1:931930581619:web:561a85ddcdfd478638d806"
    };
    
    // Inisialisasi Firebase dengan error handling
    let app, auth, db;
    try {
      app = firebase.initializeApp(firebaseConfig);
      auth = firebase.auth();
      db = firebase.firestore();
      console.log("Firebase initialized successfully");
    } catch (error) {
      console.error("Firebase initialization error:", error);
    }

    function App() {
      const [user, setUser] = useState(null);
      const [email, setEmail] = useState('test@example.com');
      const [password, setPassword] = useState('123456');
      const [error, setError] = useState('');
      const [loading, setLoading] = useState(false);
      
      // State untuk chat
      const [activeChat, setActiveChat] = useState(null);
      const [chats, setChats] = useState([]);
      const [messages, setMessages] = useState([]);
      const [message, setMessage] = useState('');
      const messagesEndRef = useRef(null);

      // Handle login
      const handleLogin = async (e) => {
        e.preventDefault();
        setError('');
        setLoading(true);
        
        try {
          await auth.signInWithEmailAndPassword(email, password);
        } catch (err) {
          setError(err.message);
          console.error("Login error:", err);
        } finally {
          setLoading(false);
        }
      };

      // Handle logout
      const handleLogout = async () => {
        try {
          await auth.signOut();
        } catch (err) {
          console.error("Logout error:", err);
        }
      };

      // Listen for auth changes
      useEffect(() => {
        const unsubscribe = auth.onAuthStateChanged((user) => {
          if (user) {
            setUser({
              email: user.email,
              uid: user.uid,
              name: user.email.split('@')[0],
              avatar: user.email.charAt(0).toUpperCase()
            });
            
            // Load dummy chats
            setChats([
              { id: '1', name: 'General Chat', lastMessage: 'Welcome to NexaChat!' },
              { id: '2', name: 'Support', lastMessage: 'How can we help you?' }
            ]);
            setActiveChat('1');
          } else {
            setUser(null);
          }
        });
        
        return () => unsubscribe();
      }, []);

      // Auto-scroll to bottom
      useEffect(() => {
        messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
      }, [messages]);

      // Send message
      const sendMessage = (e) => {
        e.preventDefault();
        if (!message.trim()) return;
        
        const newMessage = {
          id: Date.now(),
          text: message,
          sender: user.uid,
          timestamp: new Date()
        };
        
        setMessages([...messages, newMessage]);
        setMessage('');
      };

      if (!user) {
        return (
          <div className="auth-container">
            <h2 className="auth-title">Welcome to NexaChat</h2>
            <form onSubmit={handleLogin}>
              <div className="form-group">
                <input
                  type="email"
                  className="form-input"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  placeholder="Email"
                  required
                />
              </div>
              <div className="form-group">
                <input
                  type="password"
                  className="form-input"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  placeholder="Password"
                  required
                />
              </div>
              {error && <div style={{color: 'red', marginBottom: '15px'}}>{error}</div>}
              <button className="auth-button" disabled={loading}>
                {loading ? 'Logging in...' : 'Login'}
              </button>
            </form>
          </div>
        );
      }

      return (
        <div className="app-container">
          {/* Sidebar */}
          <div className="sidebar">
            <div className="sidebar-header">
              <div className="sidebar-title">NexaChat</div>
            </div>
            
            <div className="chat-list">
              {chats.map(chat => (
                <div 
                  key={chat.id}
                  className={`chat-item ${activeChat === chat.id ? 'active' : ''}`}
                  onClick={() => setActiveChat(chat.id)}
                >
                  <div style={{fontWeight: '500'}}>{chat.name}</div>
                  <div style={{fontSize: '13px', opacity: 0.8}}>{chat.lastMessage}</div>
                </div>
              ))}
            </div>
            
            <div style={{padding: '15px', borderTop: '1px solid rgba(255,255,255,0.1)'}}>
              <div style={{display: 'flex', alignItems: 'center'}}>
                <div style={{
                  width: '36px',
                  height: '36px',
                  borderRadius: '50%',
                  background: '#00B894',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  marginRight: '12px',
                  fontWeight: 'bold'
                }}>
                  {user.avatar}
                </div>
                <div>
                  <div style={{fontWeight: '500'}}>{user.name}</div>
                  <button 
                    onClick={handleLogout}
                    style={{
                      background: 'none',
                      border: 'none',
                      color: '#E17055',
                      fontSize: '13px',
                      cursor: 'pointer'
                    }}
                  >
                    Logout
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          {/* Chat Area */}
          <div className="chat-area">
            <div className="chat-header">
              <h3>{chats.find(c => c.id === activeChat)?.name || 'Chat'}</h3>
            </div>
            
            <div style={{flex: 1, padding: '20px', overflowY: 'auto', background: '#f5f5f5'}}>
              {messages.length === 0 ? (
                <div style={{textAlign: 'center', color: '#636E72', padding: '40px'}}>
                  <i className="fas fa-comments" style={{fontSize: '48px', marginBottom: '15px', opacity: 0.3}}></i>
                  <p>No messages yet. Start the conversation!</p>
                </div>
              ) : (
                messages.map(msg => (
                  <div 
                    key={msg.id}
                    style={{
                      display: 'flex',
                      marginBottom: '15px',
                      justifyContent: msg.sender === user.uid ? 'flex-end' : 'flex-start'
                    }}
                  >
                    <div className="message-bubble">
                      {msg.text}
                    </div>
                  </div>
                ))
              )}
              <div ref={messagesEndRef} />
            </div>
            
            <form onSubmit={sendMessage} style={{padding: '15px', borderTop: '1px solid #eee'}}>
              <div style={{display: 'flex', gap: '10px'}}>
                <input
                  type="text"
                  value={message}
                  onChange={(e) => setMessage(e.target.value)}
                  placeholder="Type a message..."
                  style={{
                    flex: 1,
                    padding: '12px 15px',
                    border: '1px solid #ddd',
                    borderRadius: '24px',
                    outline: 'none'
                  }}
                />
                <button 
                  type="submit"
                  style={{
                    background: '#6C5CE7',
                    color: 'white',
                    border: 'none',
                    width: '42px',
                    height: '42px',
                    borderRadius: '50%',
                    cursor: 'pointer'
                  }}
                >
                  <i className="fas fa-paper-plane"></i>
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    }

    // Render aplikasi dengan error handling
    try {
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    } catch (error) {
      console.error("Error rendering app:", error);
      document.getElementById('root').innerHTML = `
        <div style="color: red; padding: 20px; text-align: center;">
          <h2>Application Error</h2>
          <p>${error.message}</p>
          <p>Please check console for details.</p>
        </div>
      `;
    }
  </script>
</body>
</html>
